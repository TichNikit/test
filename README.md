Файл get_data

Функция get_planes_data():

Функция отправляет асинхронный запрос к API FlightRadar24, чтобы получить список активных рейсов в определенном прямоугольном географическом диапазоне: от 41 до 81 по широте и от 19 до 169 по долготе. 

Функция фильтрует полученные данные, чтобы найти только те рейсы, которые имеют регистрационные номера, начинающиеся с «B-», что указывает на китайские самолеты.

Файл db/database

Этот файл обеспечивает основные функции для управления базой данных самолетов с использованием PostgreSQL. Он включает в себя создание таблицы, добавление, извлечение, удаление и обновление записей о самолетах. Для работы с базой данных используется библиотека psycopg2, которая позволяет взаимодействовать с PostgreSQL.
Функция create_table():

Создает таблицу Planes, если она не существует. Таблица содержит три поля:
- id: уникальный идентификатор (SERIAL PRIMARY KEY)
- flightid: уникальный идентификатор полета (INTEGER NOT NULL UNIQUE)
- reg: регистрационный номер самолета (TEXT NOT NULL)

Файл tg/keybord/kb

Данный файл  включает в себя создание клавиатуры для Telegram-бота с использованием библиотеки aiogram. Клавиатура позволяет пользователю взаимодействовать с ботом через инлайн-кнопки, которые запускают определенные действия.

Файл tg/ message /message

Этот файл представляет собой реализацию логики бота на основе библиотеки aiogram, которая предназначена для работы с Telegram API. Он отвечает за обработку команд и запросов, связанных с получением данных о самолетах из сайта https://www.flightradar24.com/ и базы данных.

Функция start_command(message: types.Message):

Асинхронная функция-обработчик, которая вызывается при вводе команды /start. Она отвечает пользователю приветственным сообщением, включая его имя, и отображает начальную клавиатуру.

Функция get_data(callback_query: types.CallbackQuery):

Эта функция обрабатывает нажатие на кнопку получения данных о китайских самолетах. Она получает данные с помощью функции get_planes_data(). Формирует текстовое сообщение с информацией о каждом самолете (номер рейса и регистрационный номер). Если текст сообщения превышает 4096 символов (максимальная длина сообщения в Telegram), оно разбивается на части.

Функция get_all_from_db(callback_query: types.CallbackQuery):

Эта функция обрабатывает нажатие кнопки получения данных из базы данных, выполняя следующие действия. Она вызывает функцию get_planes() для получения данных из базы данных. Формирует текстовое сообщение аналогично функции get_data(), чтобы отправить пользователю информацию о самолетах. Сообщение разбивается на части при необходимости.

Функция register_user_messages(dp: Dispatcher): 

Эта функция регистрирует все обработчики сообщений и обратных вызовов в диспетчере dp: dp.message.register(start_command, CommandStart()) - регистрация обработчика для команды /start;  dp.callback_query.register(get_data, F.data == 'data') - регистрация обработчика для получения данных о китайских самолетах; dp.callback_query.register(get_all_from_db, F.data == 'data_bd') - регистрация обработчика для получения данных из базы данных.

Файл tg/main_tg

Этот файл представляет собой основной модуль бота на базе Telegram, написанного с использованием библиотеки aiogram. Он отвечает за инициализацию бота, настройку логирования, регистрацию обработчиков сообщений и запуск пулинга (polling) для получения обновлений от Telegram.

Функция  main():

Эта функция является основной точкой входа для запуска бота. Она создает экземпляр Bot с использованием токена для аутентификации и устанавливает режим разбора сообщений в HTML. Создает экземпляр Dispatcher, который будет использоваться для регистрации обработчиков событий. Вызывает register_user_messages(dp), чтобы зарегистрировать все обработчики сообщений, которые были определены в другом файле. Запускает процесс пулинга с помощью dp.start_polling(bot), который будет слушать обновления от Telegram.

Файл main

Этот файл представляет собой приложение на Python с использованием библиотеки PyQt5 для создания графического интерфейса (GUI). Приложение предназначено для отображения данных о китайских самолетах в специальном окне, загрузки их в базу данных, вывод их в окно логирования.

Класс FlightApp

Он наследует QWidget, основное окно приложения. В методе __init__: устанавливается заголовок окна и его размеры; cоздается вертикальный макет (QVBoxLayout), который размещает элементы интерфейса; создается список (QListWidget), который будет отображать информацию о самолетах; запуск загрузки данных с применением асинхронной функции loading_data().

Функция load_data:

Загружает данные о самолетах с использованием get_planes_data. Использует await asyncio.sleep(10) для искусственной приостановки выполнения на 10 секунд. Данные о самолетах передаются в функцию post_plane, которая сохраняет их в базу данных. Затем к каждому полету добавляется строка формата flight_id и registration в QListWidget, чтобы отобразить информацию пользователю. Лог-файл обновляется с записью о добавленных самолетах.

Файл app/schemas

Этот файл содержит определения моделей данных для работы с информацией о самолетах. Модели построены с использованием библиотеки Pydantic. Модель Plane представляет собой структуру данных для одного самолета. Она содержит следующие поля: flightid (уникальный идентификатор рейса) и reg. Модель PlanesIn используется для представления списка самолетов.

Файл app/db

Этот файл содержит определения моделей базы данных и настройки подключения для работы с информацией о самолетах с использованием SQLAlchemy в асинхронном режиме.

Модель Planes

Модель Planes используется для представления таблицы planes в базе данных. Она содержит следующие поля: id (уникальный идентификатор для каждого самолета (первичный ключ)), flightid (уникальный идентификатор рейса, должен быть уникальным в таблице), reg (регистрационный номер самолета).

Функция create_table

Эта функция создает все таблицы, определенные в метаданных Base, в базе данных, если они еще не существуют.

Файл app/routers/router_plane

Этот файл содержит определения маршрутов API для работы с данными о самолетах, используя фреймворк [FastAPI](https://fastapi.tiangolo.com/). API предоставляет возможность получать информацию о самолетах, добавлять новые записи, а также удалять существующие записи из базы данных.

Маршрут GET /planes

Этот маршрут возвращает список всех самолетов из базы данных.

Маршрут GET /planes/now

Этот маршрут возвращает список всех самолетов, которые сейчас в полете.

Маршрут POST /planes

Этот маршрут позволяет добавлять новые записи о самолетах в базу данных. Данные отправляются в теле запроса в формате JSON.

Маршрут DELETE /planes

Этот маршрут позволяет удалить все записи о самолетах из базы данных.

Файл app/repository/repository_plane

Этот файл определяет класс «PlaneRepository», который предоставляет методы для взаимодействия с базой данных, содержащей информацию о самолетах. Он использует библиотеку SQLAlchemy для выполнения асинхронных операций с базой данных, а также включает функцию для получения и загрузки данных о самолетах.

Метод get_all_plans

Этот метод извлекает все записи о самолетах из базы данных.

Метод get_plans_now

Этот метод получает текущую информацию о самолетах, используя функцию get_planes_data, которая получает данные о планах в полете из сайта https://www.flightradar24.com/.

Метод post_planes

Этот метод добавляет новые записи о самолетах в базу данных. Принимает данные о самолетах в виде списка объектов.

Метод delete_all_planes

Этот метод удаляет все записи о самолетах из базы данных.

Файл app/main_app

Файл представляет собой приложение для управления самолетами. Это приложение использует фреймворк FastAPI для разработки API, который управляет данными о самолетах. Приложение использует асинхронный контекстный менеджер для обработки жизненного цикла приложения. В частности, он создает таблицу в базе данных (если она ещё н есоздана) при запуске приложения и подключается к ней. Роутер router_planes определяет эндпоинты для взаимодействия с данными о самолетах, такие как получение списка самолетов, добавление новых данных и удаление записей.

Файл parser/parser_

Этот файл содержит скрипт, который периодически получает данные о китайских самолетах и отправляет их на сервер, использующий API FastAPI. Скрипт использует асинхронные методы для получения данных и синхронные методы для их отправки.

Функция get_list_of_chinese()

Эта функция получает данные о самолетах с помощью функции get_planes_data(). Затем она создает список, содержащий информацию о каждом рейсе (идентификатор рейса flightid и регистрационный номер reg). Функция возвращает список словарей с данными о китайских самолетах.

Функция sent_list_of_chinese(chinese)

Эта функция принимает список самолетов (аргумент chinese) и отправляет их на сервер по конечной точке «http://127.0.0.1:8000/planes» с использованием HTTP POST запроса.
Основной цикл бесконечно выполнят скрипт с промежутком в 1 час: вызывает функцию get_list_of_chinese() для получения актуальных данных о китайских самолетах; отправляет полученные данные на сервер с помощью функции sent_list_of_chinese(chinese)
